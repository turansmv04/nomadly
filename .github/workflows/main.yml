name: V3 Stable Playwright Scraper

# Manual icraya icazÉ™ verir. Siz bunu Actions panelindÉ™ Ã¶zÃ¼nÃ¼z kliklÉ™yÉ™rÉ™k iÅŸÉ™ sala bilÉ™rsiniz.
on:
  workflow_dispatch: 
  
  # HÉ™m master, hÉ™m dÉ™ main branchlarÄ±nÄ± dinlÉ™yir
  push:
    branches:
      - main
      - master
      
  # HÉ™r gÃ¼n UTC saat 08:00 (BakÄ± vaxtÄ± 12:00) iÅŸÉ™ dÃ¼ÅŸÉ™cÉ™k
  schedule:
    - cron: '0 8 * * *'

jobs:
  scrape_data_v3:
    name: Run Scraper v3
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¦ Kodu Ã§É™kin (Checkout)
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Node.js-i quraÅŸdÄ±rÄ±n (v20)
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ğŸ—ï¸ Proyekt asÄ±lÄ±lÄ±qlarÄ±nÄ± quraÅŸdÄ±rÄ±n (npm ci)
        run: npm ci

      - name: ğŸŒ Playwright Brauzer AsÄ±lÄ±lÄ±qlarÄ±nÄ± quraÅŸdÄ±rÄ±n (Chromium)
        run: npx playwright install --with-deps chromium

      - name: ğŸƒ Scraping-i iÅŸÉ™ sal (cron:scrape)
        run: npm run cron:scrape
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
