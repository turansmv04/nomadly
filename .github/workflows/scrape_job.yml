name: Scheduled Playwright Scraper

# Bu workflow hÉ™r "push" olanda vÉ™ hÉ™r gÃ¼n saat 08:00 UTC (12:00 BakÄ± vaxtÄ±) iÅŸÉ™ dÃ¼ÅŸÉ™cÉ™k
on:
  push:
    branches:
      - master  # ÆgÉ™r É™sas branch adÄ±nÄ±z "main"dirsÉ™, onu istifadÉ™ edin
  schedule:
    # HÉ™r gÃ¼n UTC saat 08:00 (BakÄ± vaxtÄ± 12:00)
    - cron: '0 8 * * *'

jobs:
  scrape_data:
    runs-on: ubuntu-latest  # Playwright Ã¼Ã§Ã¼n Linux mÃ¼hiti É™n yaxÅŸÄ±dÄ±r
    
    steps:
      - name: ğŸ“¦ Kodu Ã§É™kin (Checkout)
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Node.js-i quraÅŸdÄ±rÄ±n (v20)
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ğŸ—ï¸ Proyekt asÄ±lÄ±lÄ±qlarÄ±nÄ± quraÅŸdÄ±rÄ±n
        # 'npm ci' 'npm install'dan daha sÃ¼rÉ™tli vÉ™ daha stabil iÅŸlÉ™yir
        run: npm ci

      - name: ğŸŒ Playwright Brauzer AsÄ±lÄ±lÄ±qlarÄ±nÄ± quraÅŸdÄ±rÄ±n (Chromium)
        # Playwright-Ä±n iÅŸlÉ™mÉ™si Ã¼Ã§Ã¼n lazÄ±m olan sistem asÄ±lÄ±lÄ±qlarÄ±nÄ± yÃ¼klÉ™yir
        run: npx playwright install --with-deps chromium

      - name: ğŸƒ Scraping-i iÅŸÉ™ sal (Playwright + Supabase)
        # package.json-dakÄ± "cron:scrape" scripti iÅŸÉ™ salÄ±nÄ±r
        run: npm run cron:scrape
        env:
          # Supabase sirlÉ™ri GitHub Secrets-dÉ™n yÃ¼klÉ™nir
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
          # Daha Ã§ox dÉ™yiÅŸÉ™n varsa, bura É™lavÉ™ edin
