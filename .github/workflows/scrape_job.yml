name: 1. ğŸŒ Job Scraping Cron (Every 4 Hours)

on:
  schedule:
    # HÉ™r 4 saatdan bir iÅŸÉ™ dÃ¼ÅŸÃ¼r (00:00, 04:00, 08:00, 12:00, 16:00, 20:00 UTC)
    - cron: '0 */4 * * *' 
  workflow_dispatch: # Manual iÅŸÉ™ salma imkanÄ±

jobs:
  scrape_and_update:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¦ Kodu Ã‡Ä±xart (Tam TÉ™miz Ã‡É™kmÉ™)
        uses: actions/checkout@v4
        with:
          # Bu, tam tÉ™miz kopyalamaÄŸa mÉ™cbur edir vÉ™ potential Git/Actions cache problemini hÉ™ll edir.
          fetch-depth: 0 

      - name: ğŸ› ï¸ Node.js quraÅŸdÄ±r (v20)
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: â¬‡ï¸ AsÄ±lÄ±lÄ±qlarÄ± quraÅŸdÄ±r (Playwright/ts-node daxil)
        # Bu addÄ±m Playwright quraÅŸdÄ±rmasÄ± zamanÄ± Playwright-Ä±n Ã¶zÃ¼nÃ¼ dÉ™ quraÅŸdÄ±rÄ±r.
        run: npm install
        
      - name: ğŸƒ Scraping-i iÅŸÉ™ sal (Playwright ilÉ™)
        # Bu É™mr package.json faylÄ±nÄ±zdan cron:scrape scriptini istifadÉ™ edir.
        run: npm run cron:scrape
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
