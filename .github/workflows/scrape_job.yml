name: 1. ğŸŒ Job Scraping Cron (Every 4 Hours)

on:
  schedule:
    # HÉ™r 4 saatdan bir iÅŸÉ™ dÃ¼ÅŸÃ¼r (00:00, 04:00, 08:00, 12:00, 16:00, 20:00 UTC)
    - cron: '0 */4 * * *'
  workflow_dispatch: # Manual iÅŸÉ™ salma imkanÄ±

jobs:
  scrape_and_update:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Kodu GitHub-dan Ã§É™kir
      - name: â¬‡ï¸ Kodu Ã‡É™kmÉ™
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      # 2. Node.js-i quraÅŸdÄ±r (v20)
      - name: ğŸ› ï¸ Node.js quraÅŸdÄ±r (v20)
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 3. AsÄ±lÄ±lÄ±qlarÄ± yÃ¼klÉ™ (package.json É™sasÄ±nda)
      - name: ğŸ“¦ AsÄ±lÄ±lÄ±qlarÄ± yÃ¼klÉ™ (npm install)
        run: npm install

      # 4. Playwright-Ä±n É™sas mÃ¼hitlÉ™rini quraÅŸdÄ±r (KRÄ°TÄ°K ÆLAVÆ)
      - name: âš™ï¸ Playwright Chromium mÃ¼hitini quraÅŸdÄ±r
        run: npx playwright install --with-deps chromium
        # Bu, Linux serverindÉ™ Playwright-Ä±n iÅŸlÉ™mÉ™si Ã¼Ã§Ã¼n lazÄ±m olan bÃ¼tÃ¼n binary fayllarÄ± yÃ¼klÉ™yir.

      # 5. Scraping skriptini iÅŸÉ™ sal
      - name: ğŸƒ Scraping-i iÅŸÉ™ sal
        run: npm run cron:scrape
        # Supabase ENV-lÉ™ri inject edilir
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
