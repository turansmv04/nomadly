name: V2 Scheduled Playwright Scraper

# Bu workflow hÉ™r "push" olanda (dÉ™yiÅŸikliklÉ™ri yoxlamaq Ã¼Ã§Ã¼n)
# vÉ™ hÉ™r gÃ¼n UTC saat 08:00 (BakÄ± vaxtÄ± 12:00) iÅŸÉ™ dÃ¼ÅŸÉ™cÉ™k.
on:
  push:
    branches:
      - master  # ÆgÉ™r É™sas branch adÄ±nÄ±z "main"dirsÉ™, onu istifadÉ™ edin
  schedule:
    - cron: '0 8 * * *'

jobs:
  scrape_data_v2:
    # Bu iÅŸin adÄ±nÄ± dÉ™yiÅŸdirdik
    name: Run Scraper v2
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¦ Kodu Ã§É™kin (Checkout)
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Node.js-i quraÅŸdÄ±rÄ±n (v20)
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ğŸ—ï¸ Proyekt asÄ±lÄ±lÄ±qlarÄ±nÄ± quraÅŸdÄ±rÄ±n
        # 'npm ci' 'npm install'dan daha sÃ¼rÉ™tli vÉ™ daha stabil iÅŸlÉ™yir
        run: npm ci

      - name: ğŸŒ Playwright Brauzer AsÄ±lÄ±lÄ±qlarÄ±nÄ± quraÅŸdÄ±rÄ±n (Chromium)
        # Playwright-Ä±n iÅŸlÉ™mÉ™si Ã¼Ã§Ã¼n vacib olan sistem asÄ±lÄ±lÄ±qlarÄ±nÄ± quraÅŸdÄ±rÄ±r
        run: npx playwright install --with-deps chromium

      - name: ğŸƒ Scraping-i iÅŸÉ™ sal (Playwright + Supabase)
        # package.json-dakÄ± "cron:scrape" scripti icra edilir.
        # Bu, artÄ±q ts-node/esm xÉ™tasÄ±nÄ± aradan qaldÄ±rmaq Ã¼Ã§Ã¼n sadÉ™lÉ™ÅŸdirilmiÅŸdir.
        run: npm run cron:scrape
        env:
          # Supabase sirlÉ™ri GitHub Secrets-dÉ™n yÃ¼klÉ™nir
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
